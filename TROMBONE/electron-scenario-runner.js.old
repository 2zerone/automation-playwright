#!/usr/bin/env node

import { execFileSync, execSync, spawn } from 'child_process';
import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

console.log('ğŸº TROMBONE Electron ì‹œë‚˜ë¦¬ì˜¤ ì‹¤í–‰ê¸°\n');

// 3ë‹¨ê³„ êµ¬ì¡° ë ˆí¬íŠ¸ ì¶œë ¥ í•¨ìˆ˜
function printThreeLevelReport(scenarioId) {
    console.log(`\nğŸ“Š ì‹œë‚˜ë¦¬ì˜¤ ${scenarioId} 3ë‹¨ê³„ êµ¬ì¡° ë ˆí¬íŠ¸`);
    console.log('=' .repeat(60));
    
    // ëŒ€ë©”ë‰´ ëª©ë¡
    const mainMenus = [
        'ì—…ë¬´ì½”ë“œ ë“±ë¡',
        'íˆ´ì²´ì¸ ë“±ë¡', 
        'ì €ì¥ì†Œ ë“±ë¡',
        'ì‚¬ìš©ì ë“±ë¡',
        'ì‚¬ìš©ìì—ê²Œ ì—…ë¬´ì½”ë“œ í• ë‹¹',
        'SonarQube ë“±ë¡',
        'JUnit ë“±ë¡',
        'íŒŒì´í”„ë¼ì¸ ë“±ë¡',
        'ì›Œí¬í”Œë¡œìš° ì»´í¬ë„ŒíŠ¸ ë“±ë¡'
    ];
    
    console.log('\nğŸ“‹ 1ë‹¨ê³„: ëŒ€ë©”ë‰´ ëª©ë¡');
    console.log('-'.repeat(40));
    mainMenus.forEach((menu, index) => {
        console.log(`${index + 1}. ${menu}`);
    });
    
    // ê° ëŒ€ë©”ë‰´ë³„ ì¤‘ë©”ë‰´ ì˜ˆì‹œ
    const subMenus = {
        'ì—…ë¬´ì½”ë“œ ë“±ë¡': [
            'ì—…ë¬´ì½”ë“œ ë©”ë‰´ ì ‘ê·¼',
            'ì—…ë¬´ì½”ë“œ ë“±ë¡ í™”ë©´ ì—´ê¸°', 
            'ì—…ë¬´ì½”ë“œ ì •ë³´ ì…ë ¥',
            'ì—…ë¬´ì½”ë“œ ì €ì¥ ë° í™•ì¸'
        ],
        'íˆ´ì²´ì¸ ë“±ë¡': [
            'íˆ´ì²´ì¸ ë©”ë‰´ ì ‘ê·¼',
            'íˆ´ì²´ì¸ ë“±ë¡ í™”ë©´ ì—´ê¸°',
            'íˆ´ì²´ì¸ ê¸°ë³¸ ì •ë³´ ì…ë ¥', 
            'íˆ´ì²´ì¸ ì €ì¥ ë° í™•ì¸'
        ],
        'ì €ì¥ì†Œ ë“±ë¡': [
            'ì €ì¥ì†Œ ë©”ë‰´ ì ‘ê·¼',
            'ì €ì¥ì†Œ ë“±ë¡ í™”ë©´ ì—´ê¸°',
            'ì €ì¥ì†Œ ì •ë³´ ì…ë ¥',
            'ì €ì¥ì†Œ ì €ì¥ ë° í™•ì¸'
        ],
        'ì‚¬ìš©ì ë“±ë¡': [
            'ì‚¬ìš©ì ë©”ë‰´ ì ‘ê·¼',
            'ì‚¬ìš©ì ë“±ë¡ í™”ë©´ ì—´ê¸°',
            'ì‚¬ìš©ì ê¸°ë³¸ ì •ë³´ ì…ë ¥',
            'í‹°ì¼“ ì „ìš© ì—…ë¬´ ë° ì—­í•  ì„¤ì •',
            'ì‚¬ìš©ì ì—…ë¬´ ë° ì—­í•  ì„¤ì •',
            'ì‚¬ìš©ì êµ¬ë¶„ ì„¤ì •',
            'ì‚¬ìš©ì ì €ì¥ ë° í™•ì¸'
        ],
        'ì‚¬ìš©ìì—ê²Œ ì—…ë¬´ì½”ë“œ í• ë‹¹': [
            'ì‚¬ìš©ì ì—…ë¬´ì½”ë“œ ë©”ë‰´ ì ‘ê·¼',
            'ì‚¬ìš©ì ì—…ë¬´ì½”ë“œ ë“±ë¡ í™”ë©´ ì—´ê¸°',
            'ì‚¬ìš©ì ì—…ë¬´ì½”ë“œ ì •ë³´ ì…ë ¥',
            'ì‚¬ìš©ì ì—…ë¬´ì½”ë“œ ì €ì¥ ë° í™•ì¸'
        ],
        'SonarQube ë“±ë¡': [
            'SonarQube ë©”ë‰´ ì ‘ê·¼',
            'SonarQube ë“±ë¡ í™”ë©´ ì—´ê¸°',
            'SonarQube ì •ë³´ ì…ë ¥',
            'SonarQube ì €ì¥ ë° í™•ì¸'
        ],
        'JUnit ë“±ë¡': [
            'JUnit ë©”ë‰´ ì ‘ê·¼',
            'JUnit ë“±ë¡ í™”ë©´ ì—´ê¸°',
            'JUnit ì •ë³´ ì…ë ¥',
            'JUnit ì €ì¥ ë° í™•ì¸'
        ],
        'íŒŒì´í”„ë¼ì¸ ë“±ë¡': [
            'STG íŒŒì´í”„ë¼ì¸ ë“±ë¡',
            'PRD íŒŒì´í”„ë¼ì¸ ë“±ë¡'
        ],
        'ì›Œí¬í”Œë¡œìš° ì»´í¬ë„ŒíŠ¸ ë“±ë¡': [
            'ì›Œí¬í”Œë¡œìš° ì»´í¬ë„ŒíŠ¸ ë©”ë‰´ ì ‘ê·¼',
            'ì›Œí¬í”Œë¡œìš° ì»´í¬ë„ŒíŠ¸ ë“±ë¡ í™”ë©´ ì—´ê¸°',
            'ì›Œí¬í”Œë¡œìš° ì»´í¬ë„ŒíŠ¸ ì •ë³´ ì…ë ¥',
            'ì›Œí¬í”Œë¡œìš° ì»´í¬ë„ŒíŠ¸ ì €ì¥ ë° í™•ì¸'
        ]
    };
    
    console.log('\nğŸ“‹ 2ë‹¨ê³„: ì¤‘ë©”ë‰´ ìƒì„¸ êµ¬ì¡°');
    console.log('-'.repeat(40));
    mainMenus.forEach((mainMenu, mainIndex) => {
        console.log(`\n${mainIndex + 1}. ${mainMenu}`);
        const subMenuList = subMenus[mainMenu];
        subMenuList.forEach((subMenu, subIndex) => {
            console.log(`   ${mainIndex + 1}.${subIndex + 1} ${subMenu}`);
        });
    });
    
    console.log('\nğŸ“‹ 3ë‹¨ê³„: ìƒì„¸ê²°ê³¼');
    console.log('-'.repeat(40));
    console.log('ê° ì¤‘ë©”ë‰´ í´ë¦­ ì‹œ ìƒì„¸ í…ŒìŠ¤íŠ¸ ê²°ê³¼, ìŠ¤í¬ë¦°ìƒ·, ë¡œê·¸ í™•ì¸ ê°€ëŠ¥');
    console.log('Playwright HTML ë ˆí¬íŠ¸ì—ì„œ ìƒì„¸ ë‚´ìš© í™•ì¸ ê°€ëŠ¥');
}

// ì‹œë‚˜ë¦¬ì˜¤ ì‹¤í–‰ ì˜µì…˜
const scenarioOptions = {
    // íŠ¹ì • ì‹œë‚˜ë¦¬ì˜¤ ì‹¤í–‰
    run: (scenarioId) => {
        console.log(`ğŸš€ ì‹œë‚˜ë¦¬ì˜¤ ${scenarioId} ì‹¤í–‰ì„ ì‹œì‘í•©ë‹ˆë‹¤...\n`);
        
        // 3ë‹¨ê³„ êµ¬ì¡° ë ˆí¬íŠ¸ ë¯¸ë¦¬ë³´ê¸°
        printThreeLevelReport(scenarioId);
        
        // ì‹œë‚˜ë¦¬ì˜¤ ì„¤ì • íŒŒì¼ ì¡´ì¬ í™•ì¸
        const configPath = path.join(__dirname, `config/scenario/test-settings-${scenarioId}.json`);
        if (!fs.existsSync(configPath)) {
            console.error(`âŒ ì‹œë‚˜ë¦¬ì˜¤ ${scenarioId} ì„¤ì • íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${configPath}`);
            process.exit(1);
        }
        
        // ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ íŒŒì¼ ì¡´ì¬ í™•ì¸
        const testPath = path.join(__dirname, 'tests', 'scenario', `scenario-${scenarioId}.spec.js`);
        const interruptTestPath = path.join(__dirname, 'tests', 'test-interrupt.spec.js');
        
        let testFile = testPath;
        if (scenarioId === 'interrupt') {
            testFile = interruptTestPath;
            console.log(`\nğŸ“‹ ì¤‘ë‹¨ í…ŒìŠ¤íŠ¸ íŒŒì¼ ì‚¬ìš©: test-interrupt.js`);
        } else if (fs.existsSync(testPath)) {
            console.log(`\nğŸ“‹ í…ŒìŠ¤íŠ¸ íŒŒì¼ ì‚¬ìš©: scenario-${scenarioId}.spec.js`);
        } else {
            console.error(`âŒ ì‹œë‚˜ë¦¬ì˜¤ ${scenarioId} í…ŒìŠ¤íŠ¸ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
            console.error(`   ì°¾ì€ ê²½ë¡œ: ${testPath}`);
            process.exit(1);
        }
        
        console.log('\nğŸ”„ Playwright í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...');
        console.log('=' .repeat(60));
        
        // Playwright í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        try {
            console.log(`\nğŸ“‚ ì‹¤í–‰í•  í…ŒìŠ¤íŠ¸ íŒŒì¼: ${testFile}`);
            // ì§ì ‘ Playwright í…ŒìŠ¤íŠ¸ ì‹¤í–‰
            console.log(`ğŸ” Playwright í…ŒìŠ¤íŠ¸ ì§ì ‘ ì‹¤í–‰`);
            
            // í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
            const env = {
                ...process.env,
                PLAYWRIGHT_HEADLESS: 'false',
                NODE_ENV: 'test',
                PLAYWRIGHT_VIDEO_ENABLED: 'false'
            };
            
                        // 3ë‹¨ê³„ í”Œëœìœ¼ë¡œ Playwright ì‹¤í–‰ (ì™„ì „ êµì²´)
            const projectRoot = __dirname;
            const toPosix = p => path.resolve(p).replace(/\\/g, '/');
            const npxCmd = process.platform === 'win32' ? 'npx.cmd' : 'npx';

            const testFilePosix = toPosix(testFile);
            const scenarioDir = path.join(__dirname, 'tests', 'scenario');
            const scenarioDirPosix = toPosix(scenarioDir);
            const configPath = path.join(__dirname, 'playwright.config.js');
            const configPosix = toPosix(configPath);

            // ë””ë²„ê·¸ ë¡œê·¸(ì‹¤ì œ ë¬´ì—‡ì„ ì‹¤í–‰í•˜ëŠ”ì§€ í™•ì¸)
            console.log('--- PLAYWRIGHT DEBUG ---');
            console.log('CWD:', projectRoot);
            console.log('testFile (raw):', testFile);
            console.log('testFile (posix):', testFilePosix);
            console.log('config (posix):', configPosix);
            console.log('scenarioDir:', scenarioDir);
            if (fs.existsSync(scenarioDir)) {
              const listing = fs.readdirSync(scenarioDir);
              console.log('scenarioDir file list:\n - ' + listing.join('\n - '));
            } else {
              console.log('scenarioDir does NOT exist');
            }
            console.log('exists(testFile):', fs.existsSync(testFile));
            console.log('exists(config):', fs.existsSync(configPath));
            console.log('--- /PLAYWRIGHT DEBUG ---');

            const finalEnv = {
              ...process.env,
              PLAYWRIGHT_HEADLESS: 'false',
              NODE_ENV: 'test',
              PLAYWRIGHT_VIDEO_ENABLED: 'false'
            };

            // ê³µí†µ: ì¸ìì— "scenarioId" ê°™ì€ ìœ„ì¹˜ ì¸ì/íŒ¨í„´ ì ˆëŒ€ ë„£ì§€ ë§ ê²ƒ.
            // ì˜¤ì§ íŒŒì¼ ê²½ë¡œ ë˜ëŠ” ë””ë ‰í„°ë¦¬ ê²½ë¡œë§Œ ë„˜ê¸´ë‹¤.

            // runPlaywright í•¨ìˆ˜ ì œê±° - ì§ì ‘ execFileSync ì‚¬ìš©

            // ğŸ…°ï¸ A í”Œëœ: execSyncë¡œ ì‹¤í–‰ (POSIX ê²½ë¡œ)
            console.log('\nğŸš€ PLAN-A: execSyncë¡œ ì‹¤í–‰ (POSIX ê²½ë¡œ)');
            console.log(`ğŸ“‚ ì‹¤í–‰ ëª…ë ¹: npx playwright test "${testFilePosix}" --project=chromium`);
            
            try {
              execSync(`npx playwright test "${testFilePosix}" --project=chromium --headed`, {
                stdio: 'inherit',
                cwd: projectRoot,
                env: finalEnv
              });
              console.log('\nâœ… PLAN-A ì„±ê³µ: í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì™„ë£Œ');
            } catch (eA) {
              console.log('\nâš ï¸ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì‹¤íŒ¨:', eA?.message?.split('\n')[0] || eA?.message);
              throw new Error(`í…ŒìŠ¤íŠ¸ ì‹¤í–‰ì´ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${eA.message}`);
            }
            
            console.log('\n' + '=' .repeat(60));
            console.log(`âœ… ì‹œë‚˜ë¦¬ì˜¤ ${scenarioId} ì‹¤í–‰ ì™„ë£Œ`);
            
            // ìƒˆë¡œìš´ í…ŒìŠ¤íŠ¸ ê²°ê³¼ íŒŒì‹± ë° ì €ì¥
            console.log('\nğŸ“Š ìƒˆë¡œìš´ í…ŒìŠ¤íŠ¸ ê²°ê³¼ íŒŒì‹± ì¤‘...');
            try {
                const testResultsPath = path.join(__dirname, 'playwright-report/test-results.json');
                
                if (fs.existsSync(testResultsPath)) {
                    const testResults = JSON.parse(fs.readFileSync(testResultsPath, 'utf8'));
                    console.log('âœ… Playwright í…ŒìŠ¤íŠ¸ ê²°ê³¼ íŒŒì¼ íŒŒì‹± ì™„ë£Œ');
                    
                    // ì‹œë‚˜ë¦¬ì˜¤ë³„ ê²°ê³¼ ì¶”ì¶œ ë° ì €ì¥
                    const scenarioResults = {
                        scenarioId: scenarioId,
                        status: 'pass', // ê¸°ë³¸ê°’
                        duration: '0ë¶„',
                        startTime: new Date().toISOString(),
                        endTime: new Date().toISOString(),
                        tester: 'yh.lee5',
                        testCases: [],
                        errorDetails: null,
                        screenshots: [],
                        logs: []
                    };
                    
                    // í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¶„ì„
                    if (testResults.suites) {
                        const scenarioSuite = testResults.suites.find(suite => 
                            suite.file && suite.file.includes(`scenario/scenario-${scenarioId}.spec.js`)
                        );
                        
                        if (scenarioSuite) {
                            // í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì¶”ì¶œ
                            const extractTestCases = (suite) => {
                                let cases = [];
                                if (suite.specs) {
                                    suite.specs.forEach(spec => {
                                        if (spec.tests && spec.tests.length > 0) {
                                            spec.tests.forEach(test => {
                                                if (test.results && test.results.length > 0) {
                                                    const result = test.results[0];
                                                    // ì‹¤ì œ ì‹¤í–‰ ì‹œê°„ ê³„ì‚°
                                                    const testStartTime = new Date(Date.now() - (result.duration || 0));
                                                    const testEndTime = new Date();
                                                    
                                                    cases.push({
                                                        name: spec.title,
                                                        status: result.status === 'passed' ? 'pass' : 'fail',
                                                        duration: result.duration || 0,
                                                        error: result.error?.message || null,
                                                        startTime: testStartTime.toISOString(),
                                                        endTime: testEndTime.toISOString()
                                                    });
                                                }
                                            });
                                        }
                                    });
                                }
                                if (suite.suites) {
                                    suite.suites.forEach(subSuite => {
                                        cases = cases.concat(extractTestCases(subSuite));
                                    });
                                }
                                return cases;
                            };
                            
                            scenarioResults.testCases = extractTestCases(scenarioSuite);
                            scenarioResults.status = scenarioResults.testCases.every(tc => tc.status === 'pass') ? 'pass' : 'fail';
                            
                            console.log(`ğŸ“Š íŒŒì‹±ëœ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤: ${scenarioResults.testCases.length}ê°œ`);
                        }
                    }
                    
                    // ê²°ê³¼ë¥¼ global.testResultsì— ì €ì¥ (main.jsì—ì„œ ì ‘ê·¼ ê°€ëŠ¥)
                    const globalResultsPath = path.join(__dirname, 'custom-reports/global-test-results.json');
                    let globalResults = {};
                    
                    if (fs.existsSync(globalResultsPath)) {
                        globalResults = JSON.parse(fs.readFileSync(globalResultsPath, 'utf8'));
                    }
                    
                    globalResults[`scenario-${scenarioId}`] = scenarioResults;
                    fs.writeFileSync(globalResultsPath, JSON.stringify(globalResults, null, 2), 'utf8');
                    
                    console.log('âœ… ìƒˆë¡œìš´ í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì €ì¥ ì™„ë£Œ');
                } else {
                    console.log('âš ï¸ Playwright í…ŒìŠ¤íŠ¸ ê²°ê³¼ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('âŒ í…ŒìŠ¤íŠ¸ ê²°ê³¼ íŒŒì‹± ì¤‘ ì˜¤ë¥˜:', error.message);
            }
            
            // ìƒˆë¡œìš´ ì»¤ìŠ¤í…€ ë¦¬í¬íŠ¸ ìƒì„± (main.jsì˜ generateAndOpenCustomReport í•¨ìˆ˜ í˜¸ì¶œ)
            console.log('\nğŸ“Š ìƒˆë¡œìš´ ì»¤ìŠ¤í…€ ë¦¬í¬íŠ¸ ìƒì„± ì¤‘...');
            try {
                // main.jsì˜ generateAndOpenCustomReport í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì—¬ ìƒˆë¡œìš´ ë¦¬í¬íŠ¸ ìƒì„±
                const mainProcess = spawn('node', ['main.js', 'generate-report', scenarioId], {
                    cwd: __dirname,
                    stdio: 'inherit'
                });
                
                mainProcess.on('close', (code) => {
                    if (code === 0) {
                        console.log('âœ… ìƒˆë¡œìš´ ì»¤ìŠ¤í…€ ë¦¬í¬íŠ¸ ìƒì„± ì™„ë£Œ');
                        
                        // ìƒì„±ëœ ë¦¬í¬íŠ¸ ì—´ê¸°
                        const customReportPath = path.join(__dirname, 'custom-reports', `scenario-${scenarioId}`, 'custom-report.html');
                        if (fs.existsSync(customReportPath)) {
                            console.log('\nğŸ“Š ì»¤ìŠ¤í…€ ë¦¬í¬íŠ¸ë¥¼ ì—½ë‹ˆë‹¤...');
                            const platform = process.platform;
                            let command;
                            
                            if (platform === 'win32') {
                                command = `start "" "${customReportPath}"`;
                            } else if (platform === 'darwin') {
                                command = `open "${customReportPath}"`;
                            } else {
                                command = `xdg-open "${customReportPath}"`;
                            }
                            
                            try {
                                execSync(command, { stdio: 'inherit' });
                            } catch (error) {
                                console.error('âŒ ì»¤ìŠ¤í…€ ë¦¬í¬íŠ¸ë¥¼ ì—´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', error.message);
                            }
                        }
                    } else {
                        console.error('âŒ ì»¤ìŠ¤í…€ ë¦¬í¬íŠ¸ ìƒì„± ì‹¤íŒ¨');
                    }
                });
                
            } catch (error) {
                console.error('âŒ ì»¤ìŠ¤í…€ ë¦¬í¬íŠ¸ ìƒì„± ì¤‘ ì˜¤ë¥˜:', error.message);
            }
            
            console.log('\nğŸ“Š 3ë‹¨ê³„ êµ¬ì¡° ë ˆí¬íŠ¸ ìš”ì•½:');
            console.log('1ë‹¨ê³„: ëŒ€ë©”ë‰´ - 9ê°œ í•­ëª©');
            console.log('2ë‹¨ê³„: ì¤‘ë©”ë‰´ - ê° ëŒ€ë©”ë‰´ë³„ 2-7ê°œ í•­ëª©');
            console.log('3ë‹¨ê³„: ìƒì„¸ê²°ê³¼ - ê° ì¤‘ë©”ë‰´ë³„ ìƒì„¸ í…ŒìŠ¤íŠ¸ ê²°ê³¼');
            console.log('\nğŸ’¡ Playwright HTML ë ˆí¬íŠ¸ì—ì„œ ìƒì„¸ ë‚´ìš© í™•ì¸: playwright-report/index.html');
            
        } catch (error) {
            console.log('\n' + '=' .repeat(60));
            
            // ì—ëŸ¬ ì½”ë“œì— ë”°ë¥¸ ë©”ì‹œì§€ ë¶„ë¥˜
            if (error.status === 130) {
                // SIGINT (Ctrl+C)ë¡œ ì¤‘ë‹¨ëœ ê²½ìš°
                console.log(`â¹ï¸ ì‹œë‚˜ë¦¬ì˜¤ ${scenarioId} ì‹¤í–‰ì´ ì‚¬ìš©ìì— ì˜í•´ ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                console.log('ğŸ’¡ í…ŒìŠ¤íŠ¸ë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•˜ë ¤ë©´: node electron-scenario-runner.js run 1');
            } else if (error.status === 1) {
                // í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨
                console.log(`âŒ ì‹œë‚˜ë¦¬ì˜¤ ${scenarioId} ì‹¤í–‰ ì‹¤íŒ¨`);
                console.log('ğŸ” ì‹¤íŒ¨í•œ í…ŒìŠ¤íŠ¸ëŠ” Playwright HTML ë ˆí¬íŠ¸ì—ì„œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
            } else {
                // ê¸°íƒ€ ì˜¤ë¥˜
                console.log(`âŒ ì‹œë‚˜ë¦¬ì˜¤ ${scenarioId} ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ`);
                console.log(`ì˜¤ë¥˜ ì½”ë“œ: ${error.status}`);
                console.log(`ì˜¤ë¥˜ ë©”ì‹œì§€: ${error.message}`);
            }
            
            console.log('\nğŸ“Š 3ë‹¨ê³„ êµ¬ì¡° ë ˆí¬íŠ¸ ìƒíƒœ:');
            console.log('âš ï¸ í…ŒìŠ¤íŠ¸ê°€ ì™„ë£Œë˜ì§€ ì•Šì•„ ì¼ë¶€ ê²°ê³¼ë§Œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
            console.log('ğŸ’¡ Playwright HTML ë ˆí¬íŠ¸ì—ì„œ ì¤‘ë‹¨ ì§€ì ê¹Œì§€ì˜ ê²°ê³¼ í™•ì¸: playwright-report/index.html');
            
            process.exit(error.status || 1);
        }
    },
    
    // ì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡ ë³´ê¸°
    list: () => {
        console.log('ğŸ“‹ ì‚¬ìš© ê°€ëŠ¥í•œ ì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡:\n');
        
        const scenarioDir = path.join(__dirname, 'config/scenario');
        if (!fs.existsSync(scenarioDir)) {
            console.log('âŒ ì‹œë‚˜ë¦¬ì˜¤ ì„¤ì • ë””ë ‰í† ë¦¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            return;
        }
        
        const files = fs.readdirSync(scenarioDir)
            .filter(file => file.startsWith('test-settings-') && file.endsWith('.json'))
            .sort((a, b) => {
                const aMatch = a.match(/\d+/);
                const bMatch = b.match(/\d+/);
                if (!aMatch || !bMatch) return 0;
                const aNum = parseInt(aMatch[0]);
                const bNum = parseInt(bMatch[0]);
                return aNum - bNum;
            });
        
        if (files.length === 0) {
            console.log('âŒ ì‹œë‚˜ë¦¬ì˜¤ ì„¤ì • íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.');
            return;
        }
        
        files.forEach(file => {
            const match = file.match(/\d+/);
            if (!match) return;
            const scenarioId = match[0];
            const configPath = path.join(scenarioDir, file);
            const config = JSON.parse(fs.readFileSync(configPath, 'utf8'));
            
            const testPath = path.join(__dirname, 'tests', 'scenario', `scenario-${scenarioId}.spec.js`);
            
            let status = 'âŒ';
            if (fs.existsSync(testPath)) {
                status = 'âœ…';
            }
            
            const description = config.scenario?.description || 'ì„¤ëª… ì—†ìŒ';
            console.log(`  ${scenarioId}. ${status} ${description}`);
        });
        
        console.log('\nğŸ’¡ ëª¨ë“  ì‹œë‚˜ë¦¬ì˜¤ëŠ” ìƒì„¸ ë‹¨ê³„ë³„ í…ŒìŠ¤íŠ¸ë¥¼ ì œê³µí•©ë‹ˆë‹¤.');
    },
    
    // ì‹œë‚˜ë¦¬ì˜¤ ìƒíƒœ í™•ì¸
    status: (scenarioId) => {
        console.log(`ğŸ“Š ì‹œë‚˜ë¦¬ì˜¤ ${scenarioId} ìƒíƒœ í™•ì¸:\n`);
        
        // ì„¤ì • íŒŒì¼ í™•ì¸
        const configPath = path.join(__dirname, `config/scenario/test-settings-${scenarioId}.json`);
        if (fs.existsSync(configPath)) {
            const config = JSON.parse(fs.readFileSync(configPath, 'utf8'));
            console.log('âœ… ì„¤ì • íŒŒì¼: ì¡´ì¬');
            console.log(`   - ì‹œë‚˜ë¦¬ì˜¤ ID: ${config.scenario?.id || 'N/A'}`);
            console.log(`   - ì‹œë‚˜ë¦¬ì˜¤ íƒ€ì…: ${config.scenario?.type || 'N/A'}`);
            console.log(`   - ì„¤ëª…: ${config.scenario?.description || 'N/A'}`);
        } else {
            console.log('âŒ ì„¤ì • íŒŒì¼: ì—†ìŒ');
        }
        
        // í…ŒìŠ¤íŠ¸ íŒŒì¼ í™•ì¸
        const testPath = path.join(__dirname, 'tests', 'scenario', `scenario-${scenarioId}.spec.js`);
        
        if (fs.existsSync(testPath)) {
            console.log('âœ… í…ŒìŠ¤íŠ¸ íŒŒì¼: ì¡´ì¬');
        } else {
            console.log('âŒ í…ŒìŠ¤íŠ¸ íŒŒì¼: ì—†ìŒ');
        }
        
        // ê²°ê³¼ íŒŒì¼ í™•ì¸
        const resultPath = path.join(__dirname, 'test-results');
        if (fs.existsSync(resultPath)) {
            const resultFiles = fs.readdirSync(resultPath);
            const scenarioResults = resultFiles.filter(file => 
                file.includes(`scenario-${scenarioId}`) || 
                file.includes('detailed-results.json')
            );
            
            if (scenarioResults.length > 0) {
                console.log('âœ… ê²°ê³¼ íŒŒì¼: ì¡´ì¬');
                scenarioResults.forEach(file => {
                    console.log(`   - ${file}`);
                });
            } else {
                console.log('âŒ ê²°ê³¼ íŒŒì¼: ì—†ìŒ (ì•„ì§ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ)');
            }
        } else {
            console.log('âŒ ê²°ê³¼ ë””ë ‰í† ë¦¬: ì—†ìŒ');
        }
    },
    
    // ëŒ€ì‹œë³´ë“œ ì—´ê¸°
    dashboard: () => {
        const dashboardPath = path.join(__dirname, 'test-results/dashboard.html');
        console.log(`ğŸ“Š ëŒ€ì‹œë³´ë“œë¥¼ ì—½ë‹ˆë‹¤: ${dashboardPath}`);
        
        // ìš´ì˜ì²´ì œë³„ ë¸Œë¼ìš°ì € ì—´ê¸°
        const platform = process.platform;
        let command;
        
        if (platform === 'win32') {
            command = `start "" "${dashboardPath}"`;
        } else if (platform === 'darwin') {
            command = `open "${dashboardPath}"`;
        } else {
            command = `xdg-open "${dashboardPath}"`;
        }
        
        try {
            execSync(command, { stdio: 'inherit' });
        } catch (error) {
            console.log('ë¸Œë¼ìš°ì €ë¥¼ ìë™ìœ¼ë¡œ ì—´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ íŒŒì¼ì„ ì—´ì–´ì£¼ì„¸ìš”.');
        }
    },
    
    // Playwright ë¦¬í¬íŠ¸ ì—´ê¸°
    report: () => {
        const reportPath = path.join(__dirname, 'playwright-report/index.html');
        console.log(`ğŸ“‹ Playwright ë¦¬í¬íŠ¸ë¥¼ ì—½ë‹ˆë‹¤: ${reportPath}`);
        
        // ìš´ì˜ì²´ì œë³„ ë¸Œë¼ìš°ì € ì—´ê¸°
        const platform = process.platform;
        let command;
        
        if (platform === 'win32') {
            command = `start "" "${reportPath}"`;
        } else if (platform === 'darwin') {
            command = `open "${reportPath}"`;
        } else {
            command = `xdg-open "${reportPath}"`;
        }
        
        try {
            execSync(command, { stdio: 'inherit' });
        } catch (error) {
            console.log('ë¸Œë¼ìš°ì €ë¥¼ ìë™ìœ¼ë¡œ ì—´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ íŒŒì¼ì„ ì—´ì–´ì£¼ì„¸ìš”.');
        }
    },
    
    // í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì •ë¦¬
    clean: () => {
        console.log('ğŸ§¹ í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ ì •ë¦¬í•©ë‹ˆë‹¤...');
        
        const dirsToClean = ['playwright-report'];
        dirsToClean.forEach(dir => {
            const dirPath = path.join(__dirname, dir);
            if (fs.existsSync(dirPath)) {
                fs.rmSync(dirPath, { recursive: true, force: true });
                console.log(`âœ… ${dir} ë””ë ‰í† ë¦¬ ì‚­ì œë¨`);
            }
        });
        
        console.log('âœ… ì •ë¦¬ ì™„ë£Œ');
    },
    
    // ë„ì›€ë§
    help: () => {
        console.log(`
ğŸº TROMBONE Electron ì‹œë‚˜ë¦¬ì˜¤ ì‹¤í–‰ê¸° ì‚¬ìš©ë²•

ì‚¬ìš©ë²•: node electron-scenario-runner.js [ì˜µì…˜] [ì‹œë‚˜ë¦¬ì˜¤ID]

ì˜µì…˜:
  run <ì‹œë‚˜ë¦¬ì˜¤ID>        íŠ¹ì • ì‹œë‚˜ë¦¬ì˜¤ ì‹¤í–‰ (ì˜ˆ: run 1)
  list                    ì‚¬ìš© ê°€ëŠ¥í•œ ì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡ ë³´ê¸°
  status <ì‹œë‚˜ë¦¬ì˜¤ID>     íŠ¹ì • ì‹œë‚˜ë¦¬ì˜¤ ìƒíƒœ í™•ì¸ (ì˜ˆ: status 1)
  report                  Playwright ë¦¬í¬íŠ¸ ì—´ê¸°
  clean                   í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì •ë¦¬
  help                    ì´ ë„ì›€ë§ í‘œì‹œ

ì˜ˆì‹œ:
  node electron-scenario-runner.js run 1              # ì‹œë‚˜ë¦¬ì˜¤ 1 ì‹¤í–‰
  node electron-scenario-runner.js list               # ì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡ ë³´ê¸°
  node electron-scenario-runner.js status 1           # ì‹œë‚˜ë¦¬ì˜¤ 1 ìƒíƒœ í™•ì¸
  node electron-scenario-runner.js report             # Playwright ë¦¬í¬íŠ¸ ì—´ê¸°
  node electron-scenario-runner.js clean              # ê²°ê³¼ ì •ë¦¬

3ë‹¨ê³„ êµ¬ì¡° ë ˆí¬íŠ¸:
  1ë‹¨ê³„: ëŒ€ë©”ë‰´ ëª©ë¡ (ì—…ë¬´ì½”ë“œ ë“±ë¡, íˆ´ì²´ì¸ ë“±ë¡, ì €ì¥ì†Œ ë“±ë¡ ë“±)
  2ë‹¨ê³„: ì¤‘ë©”ë‰´ í•­ëª© (ê° ëŒ€ë©”ë‰´ë³„ ì„¸ë¶€ ë‹¨ê³„)
  3ë‹¨ê³„: ìƒì„¸ê²°ê³¼ (ê° ì¤‘ë©”ë‰´ë³„ í…ŒìŠ¤íŠ¸ ê²°ê³¼, ìŠ¤í¬ë¦°ìƒ·, ë¡œê·¸)

QAë¥¼ ìœ„í•œ ì„¸ë¶€ ë‹¨ê³„ë³„ í…ŒìŠ¤íŠ¸:
  - ëª¨ë“  ì‹œë‚˜ë¦¬ì˜¤ëŠ” ê° ë‹¨ê³„ë§ˆë‹¤ PASS/FAIL ê²°ê³¼ ì œê³µ
  - ìƒì„¸í•œ ë¡œê·¸ì™€ ì†Œìš”ì‹œê°„ ì •ë³´ í¬í•¨

ê²°ê³¼ íŒŒì¼:
  - playwright-report/index.html         # Playwright HTML ë¦¬í¬íŠ¸ (3ë‹¨ê³„ êµ¬ì¡°)
        `);
    }
};

// ëª…ë ¹í–‰ ì¸ìˆ˜ ì²˜ë¦¬
const args = process.argv.slice(2);
const command = args[0];

if (!command || command === 'help') {
    scenarioOptions.help();
} else if (scenarioOptions[command]) {
    if (command === 'run' || command === 'status') {
        const scenarioId = args[1];
        if (!scenarioId) {
            console.error('âŒ ì‹œë‚˜ë¦¬ì˜¤ IDê°€ í•„ìš”í•©ë‹ˆë‹¤.');
            scenarioOptions.help();
            process.exit(1);
        }
        scenarioOptions[command](scenarioId);
    } else {
        scenarioOptions[command]();
    }
} else {
    console.error('âŒ ì•Œ ìˆ˜ ì—†ëŠ” ëª…ë ¹ì…ë‹ˆë‹¤:', command);
    scenarioOptions.help();
    process.exit(1);
}

console.log('\nğŸ ì‹œë‚˜ë¦¬ì˜¤ ì‹¤í–‰ê¸° ì¢…ë£Œ'); 