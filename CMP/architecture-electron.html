<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Electron ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì„±ë„</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 10px;
            background: #f5f5f5;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
            margin-top: 0;
        }
        .mermaid {
            background: white;
            padding: 10px;
            border-radius: 4px;
            overflow: hidden;
        }
        .mermaid svg {
            max-width: 100%;
            height: auto;
        }
        .download-btn {
            display: inline-block;
            margin-top: 15px;
            padding: 10px 20px;
            background: #4CAF50;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            cursor: pointer;
            border: none;
        }
        .download-btn:hover {
            background: #45a049;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“± Electron ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì„±ë„</h1>
        <div class="mermaid">
graph TB
    subgraph "Electron ì• í”Œë¦¬ì¼€ì´ì…˜"
        subgraph "ë©”ì¸ í”„ë¡œì„¸ìŠ¤"
            MainProcess["main.js<br/>Electron ë©”ì¸ í”„ë¡œì„¸ìŠ¤"]
            MainProcess --> |ì´ˆê¸° ë¡œë“œ| ProductSelector["product-selector.html<br/>ì œí’ˆ ì„ íƒ í™”ë©´"]
        end
        
        subgraph "ì œí’ˆ ì„ íƒ"
            ProductSelector --> |ì œí’ˆ ì„ íƒ| SelectTrombone["TROMBONE ì„ íƒ"]
            ProductSelector --> |ì œí’ˆ ì„ íƒ| SelectViola["VIOLA ì„ íƒ"]
            ProductSelector --> |ì œí’ˆ ì„ íƒ| SelectContrabass["CONTRABASS ì„ íƒ"]
            ProductSelector --> |ì œí’ˆ ì„ íƒ| SelectCMP["CMP ì„ íƒ"]
        end
        
        subgraph "ì œí’ˆë³„ GUI í™”ë©´"
            TromboneGUI["TROMBONE/<br/>trombone-main.html"]
            ViolaGUI["VIOLA/<br/>viola-main.html"]
            ContrabassGUI["CONTRABASS/<br/>contrabass-main.html"]
            CMPGUI["CMP/<br/>cmp-main.html<br/>(ì˜ˆì‹œ: ìƒì„¸ êµ¬ì¡°)"]
            
            SelectTrombone --> TromboneGUI
            SelectViola --> ViolaGUI
            SelectContrabass --> ContrabassGUI
            SelectCMP --> CMPGUI
        end
        
        subgraph "CMP ì œí’ˆ ìƒì„¸ êµ¬ì¡° ì˜ˆì‹œ"
            subgraph "ë Œë”ëŸ¬ í”„ë¡œì„¸ìŠ¤ GUI"
                CMPGUI --> |ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ| ScenarioSelect["ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ UI"]
                CMPGUI --> |ì‹¤í–‰ ë²„íŠ¼ í´ë¦­| RunBtn["ì‹¤í–‰ ë²„íŠ¼"]
                CMPGUI --> |ë¡œê·¸ í™•ì¸| LogView["ì‹¤ì‹œê°„ ë¡œê·¸ ë·°ì–´"]
                CMPGUI --> |ì´ë ¥ ê´€ë¦¬| HistoryTab["ì´ë ¥ ê´€ë¦¬ íƒ­"]
            end
            
            subgraph "ë©”ì¸ í”„ë¡œì„¸ìŠ¤ IPC"
                IPC["IPC í•¸ë“¤ëŸ¬<br/>- generate-custom-report<br/>- run-scenario<br/>- open-custom-report"]
            end
            
            subgraph "í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì—”ì§„"
                Runner["electron-scenario-runner.js<br/>ì‹œë‚˜ë¦¬ì˜¤ ì‹¤í–‰ ì—”ì§„"]
                Runner --> |Playwright ì‹¤í–‰| Playwright["Playwright<br/>ë¸Œë¼ìš°ì € ìë™í™”"]
            end
            
            subgraph "í…ŒìŠ¤íŠ¸ íŒŒì¼"
                SpecFiles["tests/scenario/<br/>scenario-*.spec.js"]
                SpecFiles --> |í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‹¤í–‰| TestCases["í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤"]
            end
            
            subgraph "Manager í´ë˜ìŠ¤"
                BaseMgr["lib/classes/<br/>BaseManager.js"]
                LoginMgr["lib/classes/<br/>LoginManager.js"]
                ProductMgr["lib/classes/<br/>ì œí’ˆë³„ Manager"]
                BaseMgr --> |ìƒì†| LoginMgr
                BaseMgr --> |ìƒì†| ProductMgr
                TestCases --> |ì‚¬ìš©| LoginMgr
                TestCases --> |ì‚¬ìš©| ProductMgr
            end
            
            subgraph "ë¦¬í¬íŠ¸ ìƒì„±"
                ReportGen["lib/report-generator.js<br/>ë¦¬í¬íŠ¸ ìƒì„± ì—”ì§„"]
                ReportGen --> |HTML ìƒì„±| CustomReport["custom-reports/<br/>ì»¤ìŠ¤í…€ ë¦¬í¬íŠ¸"]
            end
            
            subgraph "ì„¤ì • íŒŒì¼"
                Config["config/<br/>test-settings.json"]
                Config --> |ì„¤ì • ë¡œë“œ| Runner
                Config --> |ì„¤ì • ë¡œë“œ| ReportGen
            end
            
            subgraph "ë°ì´í„° ì €ì¥"
                GlobalResults["custom-reports/<br/>global-test-results.json"]
            end
            
            RunBtn --> |IPC í˜¸ì¶œ| IPC
            IPC --> |ì‹œë‚˜ë¦¬ì˜¤ ì‹¤í–‰| Runner
            Runner --> |í…ŒìŠ¤íŠ¸ íŒŒì¼ ë¡œë“œ| SpecFiles
            Playwright --> |í…ŒìŠ¤íŠ¸ ê²°ê³¼| GlobalResults
            Runner --> |í…ŒìŠ¤íŠ¸ ì™„ë£Œ| IPC
            IPC --> |ë¦¬í¬íŠ¸ ìƒì„± ìš”ì²­| ReportGen
            ReportGen --> |ë¦¬í¬íŠ¸ ë°ì´í„° ì½ê¸°| GlobalResults
            ReportGen --> |ë¦¬í¬íŠ¸ ì €ì¥| CustomReport
            IPC --> |ë¡œê·¸ ì „ë‹¬| LogView
            IPC --> |ì´ë ¥ ì—…ë°ì´íŠ¸| HistoryTab
        end
        
        subgraph "ë‹¤ë¥¸ ì œí’ˆë“¤ ë™ì¼ êµ¬ì¡°"
            Note["TROMBONE, VIOLA, CONTRABASSë„<br/>CMPì™€ ë™ì¼í•œ êµ¬ì¡°ë¥¼ ê°€ì§<br/>- ê° ì œí’ˆë³„ main.html<br/>- electron-scenario-runner.js<br/>- lib/report-generator.js<br/>- tests/scenario/<br/>- config/test-settings.json"]
        end
    end
    
    style MainProcess fill:#e1f5ff
    style ProductSelector fill:#fff4e1
    style CMPGUI fill:#ffe1f5
    style IPC fill:#fff4e1
    style Runner fill:#ffe1f5
    style ReportGen fill:#e1ffe1
    style Playwright fill:#f5e1ff
    style Note fill:#f0f0f0
        </div>
        
        <button class="download-btn" onclick="downloadAsImage()">ì´ë¯¸ì§€ë¡œ ì €ì¥</button>
    </div>
    
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });
        
        // ë‹¤ì´ì–´ê·¸ë¨ ë¡œë“œ í›„ ë¶ˆí•„ìš”í•œ ì—¬ë°± ì œê±°
        window.addEventListener('load', function() {
            setTimeout(function() {
                const svg = document.querySelector('.mermaid svg');
                if (svg) {
                    // SVGì˜ ì‹¤ì œ í¬ê¸°ì— ë§ì¶° ì»¨í…Œì´ë„ˆ ì¡°ì •
                    const bbox = svg.getBBox();
                    const mermaidContainer = document.querySelector('.mermaid');
                    if (mermaidContainer) {
                        mermaidContainer.style.height = 'auto';
                        mermaidContainer.style.paddingBottom = '10px';
                    }
                }
            }, 500);
        });
        
        function downloadAsImage() {
            try {
                const svg = document.querySelector('.mermaid svg');
                if (!svg) {
                    alert('SVGë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì´ì–´ê·¸ë¨ì´ ë¡œë“œë  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.');
                    return;
                }
                
                // ì›ë³¸ SVGì˜ í¬ê¸° ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                const viewBox = svg.getAttribute('viewBox');
                const svgWidth = svg.getAttribute('width');
                const svgHeight = svg.getAttribute('height');
                
                // viewBoxì—ì„œ í¬ê¸° ì¶”ì¶œ
                let width, height;
                if (viewBox) {
                    const parts = viewBox.split(' ');
                    width = parseFloat(parts[2]);
                    height = parseFloat(parts[3]);
                } else {
                    width = parseFloat(svgWidth) || 1200;
                    height = parseFloat(svgHeight) || 800;
                }
                
                // SVG ë³µì‚¬ë³¸ ìƒì„± (ì›ë³¸ ë³€ê²½ ë°©ì§€)
                const svgClone = svg.cloneNode(true);
                
                // ë³µì‚¬ë³¸ì˜ ì†ì„± ì„¤ì •
                svgClone.setAttribute('width', width);
                svgClone.setAttribute('height', height);
                if (viewBox) {
                    svgClone.setAttribute('viewBox', viewBox);
                }
                
                // ë„¤ì„ìŠ¤í˜ì´ìŠ¤ í™•ì¸ ë° ì¶”ê°€
                if (!svgClone.getAttribute('xmlns')) {
                    svgClone.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
                }
                
                // SVG ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const svgData = new XMLSerializer().serializeToString(svgClone);
                
                // SVGë¥¼ base64ë¡œ ì¸ì½”ë”©
                const base64Svg = btoa(unescape(encodeURIComponent(svgData)));
                const svgDataUri = 'data:image/svg+xml;base64,' + base64Svg;
                
                // Canvas ìƒì„±
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const img = new Image();
                
                // CORS ë¬¸ì œ ë°©ì§€ë¥¼ ìœ„í•´ crossOrigin ì„¤ì •
                img.crossOrigin = 'anonymous';
                
                img.onload = function() {
                    try {
                        // Canvas í¬ê¸°ë¥¼ ì´ë¯¸ì§€ í¬ê¸°ì— ë§ì¶¤
                        canvas.width = img.width;
                        canvas.height = img.height;
                        
                        // ë°°ê²½ìƒ‰ ì„¤ì •
                        ctx.fillStyle = 'white';
                        ctx.fillRect(0, 0, canvas.width, canvas.height);
                        
                        // ì´ë¯¸ì§€ ê·¸ë¦¬ê¸°
                        ctx.drawImage(img, 0, 0);
                        
                        // PNGë¡œ ë³€í™˜í•˜ì—¬ ë‹¤ìš´ë¡œë“œ
                        canvas.toBlob(function(blob) {
                            if (!blob) {
                                alert('ì´ë¯¸ì§€ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                                return;
                            }
                            
                            const link = document.createElement('a');
                            link.download = 'architecture-electron.png';
                            link.href = URL.createObjectURL(blob);
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                            
                            // ë©”ëª¨ë¦¬ ì •ë¦¬
                            URL.revokeObjectURL(link.href);
                            
                            console.log('ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ');
                        }, 'image/png');
                    } catch (error) {
                        console.error('ì´ë¯¸ì§€ ë³€í™˜ ì˜¤ë¥˜:', error);
                        alert('ì´ë¯¸ì§€ ë³€í™˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                    }
                };
                
                img.onerror = function() {
                    console.error('ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨');
                    alert('SVG ì´ë¯¸ì§€ ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                };
                
                img.src = svgDataUri;
            } catch (error) {
                console.error('ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜:', error);
                alert('ì´ë¯¸ì§€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }
    </script>
</body>
</html>

