<!-- 
=================================================================
VIOLA Playwright MCP íƒ­ ì¶”ê°€ ì½”ë“œ
=================================================================
ì´ íŒŒì¼ì˜ ë‚´ìš©ì„ viola-main.htmlì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.

ì‚¬ìš© ë°©ë²•:
1. <!-- MCP íƒ­ HTML ì¶”ê°€ --> ì„¹ì…˜ì„ ì´ë ¥ ê´€ë¦¬ íƒ­ ë‹¤ìŒì— ë¶™ì—¬ë„£ê¸°
2. /* MCP íƒ­ CSS */ ì„¹ì…˜ì„ </style> ì§ì „ì— ë¶™ì—¬ë„£ê¸°  
3. // MCP íƒ­ JavaScript ì„¹ì…˜ì„ </script> ì§ì „ì— ë¶™ì—¬ë„£ê¸°
4. ë„¤ë¹„ê²Œì´ì…˜ ì•„ì´í…œì€ ì´ë¯¸ ì¶”ê°€ë˜ì–´ ìˆìŒ
=================================================================
-->

<!-- ==================== MCP íƒ­ HTML ì¶”ê°€ (ì´ë ¥ ê´€ë¦¬ íƒ­ ë‹¤ìŒì— ë¶™ì—¬ë„£ê¸°) ==================== -->

            <!-- Playwright MCP íƒ­ -->
            <div id="playwright-mcp" class="tab-content">
                <div class="content-header">
                    <h2>ğŸ¤– Playwright MCP</h2>
                    <p>ìì—°ì–´ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ìš”ì²­í•˜ê³ , MCPë¥¼ í™œìš©í•œ ìë™í™”ëœ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.</p>
                </div>
                <div class="content-body">
                    <!-- í”„ë¡¬í”„íŠ¸ ì…ë ¥ ì„¹ì…˜ -->
                    <div class="mcp-prompt-section">
                        <h3>ğŸ’¬ í…ŒìŠ¤íŠ¸ ìš”ì²­</h3>
                        <div class="mcp-prompt-container">
                            <textarea id="mcpPromptInput" class="mcp-prompt-input" 
                                placeholder="ì˜ˆ: 'ë¡œê·¸ì¸í•´ì„œ Pod ìƒì„± í…ŒìŠ¤íŠ¸ í•´ì¤˜'" 
                                rows="4"></textarea>
                            <div class="mcp-button-group">
                                <button class="btn-primary" onclick="executeMCPTest()">
                                    <i class="fas fa-play"></i> í…ŒìŠ¤íŠ¸ ì‹¤í–‰
                                </button>
                                <button class="btn-secondary" onclick="saveMCPPrompt()">
                                    <i class="fas fa-save"></i> í”„ë¡¬í”„íŠ¸ ì €ì¥
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- ì €ì¥ëœ í”„ë¡¬í”„íŠ¸ ëª©ë¡ -->
                    <div class="mcp-saved-prompts-section">
                        <div class="section-header">
                            <h3>ğŸ“š ì €ì¥ëœ í”„ë¡¬í”„íŠ¸</h3>
                            <button class="btn-secondary btn-sm" onclick="showAddPromptDialog()">
                                <i class="fas fa-plus"></i> ìƒˆ í”„ë¡¬í”„íŠ¸ ì¶”ê°€
                            </button>
                        </div>
                        <div id="mcpSavedPromptsList" class="mcp-prompts-grid">
                            <!-- ì €ì¥ëœ í”„ë¡¬í”„íŠ¸ ì¹´ë“œë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                        </div>
                    </div>

                    <!-- MCP ì‹¤í–‰ ë¡œê·¸ -->
                    <div class="mcp-log-section">
                        <h3>ğŸ“‹ ì‹¤í–‰ ë¡œê·¸</h3>
                        <div id="mcpLogContainer" class="mcp-log-container">
                            <div class="log-placeholder">í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
                        </div>
                    </div>
                </div>
            </div>


<!-- ==================== MCP íƒ­ CSS (</style> ì§ì „ì— ë¶™ì—¬ë„£ê¸°) ==================== -->

        /* Playwright MCP íƒ­ ìŠ¤íƒ€ì¼ */
        .mcp-prompt-section,
        .mcp-saved-prompts-section,
        .mcp-log-section {
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 12px;
            padding: 25px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .mcp-prompt-section h3,
        .mcp-saved-prompts-section h3,
        .mcp-log-section h3 {
            font-size: 1.3em;
            margin-bottom: 20px;
            color: #000000;
            font-weight: 600;
        }

        .mcp-prompt-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .mcp-prompt-input {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            color: #000000;
            font-size: 1em;
            font-family: inherit;
            resize: vertical;
            transition: all 0.3s ease;
        }

        .mcp-prompt-input:focus {
            outline: none;
            border-color: #10b981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .mcp-button-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.9em;
        }

        .mcp-prompts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
        }

        .mcp-prompt-card {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .mcp-prompt-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border-color: #10b981;
        }

        .mcp-prompt-card-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #000000;
            font-size: 1.05em;
        }

        .mcp-prompt-card-content {
            color: #666;
            font-size: 0.9em;
            line-height: 1.5;
            margin-bottom: 12px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .mcp-prompt-card-actions {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }

        .mcp-prompt-card-actions button {
            padding: 6px 12px;
            font-size: 0.85em;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mcp-prompt-card-actions .btn-use {
            background: #10b981;
            color: white;
        }

        .mcp-prompt-card-actions .btn-use:hover {
            background: #059669;
        }

        .mcp-prompt-card-actions .btn-edit {
            background: #3b82f6;
            color: white;
        }

        .mcp-prompt-card-actions .btn-edit:hover {
            background: #2563eb;
        }

        .mcp-prompt-card-actions .btn-delete {
            background: #ef4444;
            color: white;
        }

        .mcp-prompt-card-actions .btn-delete:hover {
            background: #dc2626;
        }

        .mcp-log-container {
            background: rgba(0, 0, 0, 0.9);
            color: #10b981;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.6;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .log-placeholder {
            color: #666;
            text-align: center;
            padding: 40px;
        }

        .mcp-log-entry {
            margin-bottom: 8px;
            padding: 4px 0;
        }

        .mcp-log-entry.info {
            color: #10b981;
        }

        .mcp-log-entry.success {
            color: #22c55e;
        }

        .mcp-log-entry.error {
            color: #ef4444;
        }

        .mcp-log-entry.warning {
            color: #f59e0b;
        }


<!-- ==================== MCP íƒ­ JavaScript (</script> ì§ì „ì— ë¶™ì—¬ë„£ê¸°) ==================== -->

        // ==================== Playwright MCP íƒ­ ê´€ë ¨ í•¨ìˆ˜ë“¤ ====================
        
        // MCP í”„ë¡¬í”„íŠ¸ ì €ì¥ì†Œ (LocalStorageì— ì €ì¥)
        const MCP_PROMPTS_KEY = 'viola_mcp_prompts';
        
        // MCP íƒ­ ì´ˆê¸°í™”
        function initializeMCPTab() {
            console.log('ğŸ¤– MCP íƒ­ ì´ˆê¸°í™” ì¤‘...');
            loadSavedPrompts();
        }
        
        // ì €ì¥ëœ í”„ë¡¬í”„íŠ¸ ë¡œë“œ
        function loadSavedPrompts() {
            const prompts = getMCPPrompts();
            const promptsList = document.getElementById('mcpSavedPromptsList');
            
            if (!promptsList) return;
            
            if (prompts.length === 0) {
                promptsList.innerHTML = `
                    <div class="log-placeholder">
                        ì €ì¥ëœ í”„ë¡¬í”„íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.<br>
                        ìì£¼ ì‚¬ìš©í•˜ëŠ” í”„ë¡¬í”„íŠ¸ë¥¼ ì €ì¥í•˜ì—¬ ë¹ ë¥´ê²Œ ì¬ì‚¬ìš©í•˜ì„¸ìš”.
                    </div>
                `;
                return;
            }
            
            promptsList.innerHTML = '';
            prompts.forEach(prompt => {
                const card = createPromptCard(prompt);
                promptsList.appendChild(card);
            });
        }
        
        // í”„ë¡¬í”„íŠ¸ ì¹´ë“œ ìƒì„±
        function createPromptCard(prompt) {
            const card = document.createElement('div');
            card.className = 'mcp-prompt-card';
            card.innerHTML = `
                <div class="mcp-prompt-card-title">${escapeHtml(prompt.title)}</div>
                <div class="mcp-prompt-card-content">${escapeHtml(prompt.content)}</div>
                <div class="mcp-prompt-card-actions">
                    <button class="btn-use" onclick="useSavedPrompt('${prompt.id}')">
                        <i class="fas fa-play"></i> ì‚¬ìš©
                    </button>
                    <button class="btn-edit" onclick="editPrompt('${prompt.id}')">
                        <i class="fas fa-edit"></i> ìˆ˜ì •
                    </button>
                    <button class="btn-delete" onclick="deletePrompt('${prompt.id}')">
                        <i class="fas fa-trash"></i> ì‚­ì œ
                    </button>
                </div>
            `;
            return card;
        }
        
        // LocalStorageì—ì„œ í”„ë¡¬í”„íŠ¸ ê°€ì ¸ì˜¤ê¸°
        function getMCPPrompts() {
            try {
                const prompts = localStorage.getItem(MCP_PROMPTS_KEY);
                return prompts ? JSON.parse(prompts) : [];
            } catch (error) {
                console.error('í”„ë¡¬í”„íŠ¸ ë¡œë“œ ì‹¤íŒ¨:', error);
                return [];
            }
        }
        
        // LocalStorageì— í”„ë¡¬í”„íŠ¸ ì €ì¥
        function saveMCPPromptsToStorage(prompts) {
            try {
                localStorage.setItem(MCP_PROMPTS_KEY, JSON.stringify(prompts));
                return true;
            } catch (error) {
                console.error('í”„ë¡¬í”„íŠ¸ ì €ì¥ ì‹¤íŒ¨:', error);
                showToast('í”„ë¡¬í”„íŠ¸ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                return false;
            }
        }
        
        // í”„ë¡¬í”„íŠ¸ ì €ì¥ (í˜„ì¬ ì…ë ¥ë€ì˜ ë‚´ìš©)
        async function saveMCPPrompt() {
            const input = document.getElementById('mcpPromptInput');
            const content = input.value.trim();
            
            if (!content) {
                showToast('í”„ë¡¬í”„íŠ¸ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }
            
            // ì œëª© ì…ë ¥ ë°›ê¸°
            const title = prompt('í”„ë¡¬í”„íŠ¸ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”:', content.substring(0, 30) + '...');
            if (!title) return;
            
            const prompts = getMCPPrompts();
            const newPrompt = {
                id: Date.now().toString(),
                title: title.trim(),
                content: content,
                createdAt: new Date().toISOString()
            };
            
            prompts.push(newPrompt);
            
            if (saveMCPPromptsToStorage(prompts)) {
                showToast('âœ… í”„ë¡¬í”„íŠ¸ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                loadSavedPrompts();
            }
        }
        
        // ìƒˆ í”„ë¡¬í”„íŠ¸ ì¶”ê°€ ë‹¤ì´ì–¼ë¡œê·¸
        function showAddPromptDialog() {
            const title = prompt('í”„ë¡¬í”„íŠ¸ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”:');
            if (!title) return;
            
            const content = prompt('í”„ë¡¬í”„íŠ¸ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”:');
            if (!content) return;
            
            const prompts = getMCPPrompts();
            const newPrompt = {
                id: Date.now().toString(),
                title: title.trim(),
                content: content.trim(),
                createdAt: new Date().toISOString()
            };
            
            prompts.push(newPrompt);
            
            if (saveMCPPromptsToStorage(prompts)) {
                showToast('âœ… í”„ë¡¬í”„íŠ¸ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                loadSavedPrompts();
            }
        }
        
        // ì €ì¥ëœ í”„ë¡¬í”„íŠ¸ ì‚¬ìš©
        function useSavedPrompt(promptId) {
            const prompts = getMCPPrompts();
            const prompt = prompts.find(p => p.id === promptId);
            
            if (!prompt) {
                showToast('í”„ë¡¬í”„íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            const input = document.getElementById('mcpPromptInput');
            input.value = prompt.content;
            input.focus();
            
            showToast(`ğŸ“ "${prompt.title}" í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥ë€ì— ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`, 'info');
        }
        
        // í”„ë¡¬í”„íŠ¸ ìˆ˜ì •
        function editPrompt(promptId) {
            const prompts = getMCPPrompts();
            const promptIndex = prompts.findIndex(p => p.id === promptId);
            
            if (promptIndex === -1) {
                showToast('í”„ë¡¬í”„íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            const prompt = prompts[promptIndex];
            const newTitle = prompt('ì œëª© ìˆ˜ì •:', prompt.title);
            if (!newTitle) return;
            
            const newContent = prompt('ë‚´ìš© ìˆ˜ì •:', prompt.content);
            if (!newContent) return;
            
            prompts[promptIndex] = {
                ...prompt,
                title: newTitle.trim(),
                content: newContent.trim(),
                updatedAt: new Date().toISOString()
            };
            
            if (saveMCPPromptsToStorage(prompts)) {
                showToast('âœ… í”„ë¡¬í”„íŠ¸ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                loadSavedPrompts();
            }
        }
        
        // í”„ë¡¬í”„íŠ¸ ì‚­ì œ
        function deletePrompt(promptId) {
            if (!confirm('ì´ í”„ë¡¬í”„íŠ¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            const prompts = getMCPPrompts();
            const filteredPrompts = prompts.filter(p => p.id !== promptId);
            
            if (saveMCPPromptsToStorage(filteredPrompts)) {
                showToast('âœ… í”„ë¡¬í”„íŠ¸ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                loadSavedPrompts();
            }
        }
        
        // MCP í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        async function executeMCPTest() {
            const input = document.getElementById('mcpPromptInput');
            const promptText = input.value.trim();
            
            if (!promptText) {
                showToast('í…ŒìŠ¤íŠ¸ ìš”ì²­ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }
            
            addMCPLog('info', `ğŸ¤– MCP í…ŒìŠ¤íŠ¸ ìš”ì²­: ${promptText}`);
            addMCPLog('info', 'ğŸ“‹ VIOLA MD ë¬¸ì„œ ë¡œë”© ì¤‘...');
            
            try {
                // IPCë¥¼ í†µí•´ ë©”ì¸ í”„ë¡œì„¸ìŠ¤ì— MCP í…ŒìŠ¤íŠ¸ ìš”ì²­
                const result = await ipcRenderer.invoke('execute-mcp-test', {
                    product: 'VIOLA',
                    prompt: promptText
                });
                
                if (result.success) {
                    addMCPLog('success', 'âœ… MCP í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì„±ê³µ');
                    addMCPLog('info', result.message || 'í…ŒìŠ¤íŠ¸ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    
                    if (result.logs) {
                        result.logs.forEach(log => {
                            addMCPLog(log.type || 'info', log.message);
                        });
                    }
                    
                    showToast('âœ… MCP í…ŒìŠ¤íŠ¸ê°€ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                } else {
                    addMCPLog('error', 'âŒ MCP í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì‹¤íŒ¨');
                    addMCPLog('error', result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜');
                    showToast('âŒ MCP í…ŒìŠ¤íŠ¸ ì‹¤í–‰ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            } catch (error) {
                addMCPLog('error', `âŒ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`);
                console.error('MCP í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì˜¤ë¥˜:', error);
                showToast('âŒ MCP í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }
        
        // MCP ë¡œê·¸ ì¶”ê°€
        function addMCPLog(type, message) {
            const logContainer = document.getElementById('mcpLogContainer');
            if (!logContainer) return;
            
            // í”Œë ˆì´ìŠ¤í™€ë” ì œê±°
            const placeholder = logContainer.querySelector('.log-placeholder');
            if (placeholder) {
                placeholder.remove();
            }
            
            const timestamp = new Date().toLocaleTimeString('ko-KR');
            const logEntry = document.createElement('div');
            logEntry.className = `mcp-log-entry ${type}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        // MCP ë¡œê·¸ ì´ˆê¸°í™”
        function clearMCPLog() {
            const logContainer = document.getElementById('mcpLogContainer');
            if (!logContainer) return;
            
            logContainer.innerHTML = '<div class="log-placeholder">í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>';
        }
        
        // HTML ì´ìŠ¤ì¼€ì´í”„ (XSS ë°©ì§€)
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }
        
        // ê¸°ì¡´ switchTab í•¨ìˆ˜ ìˆ˜ì • (MCP íƒ­ ì´ˆê¸°í™” ì¶”ê°€)
        // ì›ë˜ switchTab í•¨ìˆ˜ë¥¼ ì°¾ì•„ì„œ ì•„ë˜ ì½”ë“œ ì¶”ê°€
        /*
        if (tabName === 'playwright-mcp') {
            console.log('Playwright MCP íƒ­ìœ¼ë¡œ ì „í™˜');
            initializeMCPTab();
        }
        */


